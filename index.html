<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Self Transfer</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">

  <style>
    body {
      font-family: Arial, sans-serif;
      background: #f5f5f5;
      padding: 20px;
    }
    form {
      background: #ffffff;
      padding: 20px;
      border-radius: 8px;
      max-width: 430px;
      margin: auto;
      box-shadow: 0 0 10px rgba(0,0,0,0.1);
    }
    label {
      font-weight: bold;
      margin-top: 10px;
      display: block;
    }
    input, select, textarea, button {
      width: 100%;
      padding: 8px;
      margin-top: 5px;
    }
    textarea {
      resize: vertical;
    }
    hr {
      margin: 15px 0;
    }
    button {
      margin-top: 15px;
      background: #007bff;
      color: white;
      border: none;
      font-size: 16px;
      cursor: pointer;
    }
    button:hover {
      background: #0056b3;
    }

    /* Denomination Grid */
    #denominations {
      display: grid;
      grid-template-columns: repeat(3, 1fr);
      gap: 8px 12px;
    }
    .denom-row {
      display: flex;
      align-items: center;
      gap: 6px;
    }
    .denom-row label {
      width: 45px;
      margin: 0;
      font-weight: bold;
    }
  </style>
</head>

<body>

<form id="transferForm">
  <h2>Self Transfer</h2>

  <label>Date</label>
  <input type="date" id="date" required>

  <label>Narration</label>
  <textarea id="narration" rows="2" required></textarea>

  <hr>

  <h3>From</h3>
  <label>Transaction Type</label>
  <select id="from_trtype" required>
    <option value="">Select</option>
    <option value="cash">Cash</option>
    <option value="upi">UPI</option>
    <option value="net">Net Banking</option>
    <option value="debit">Debit</option>
    <option value="credit">Credit</option>
  </select>

  <label id="fromLabel" style="display:none;">From Account</label>
  <select id="from_account" style="display:none;"></select>

  <hr>

  <h3>To</h3>
  <label>Transaction Type</label>
  <select id="to_trtype" required>
    <option value="">Select</option>
    <option value="cash">Cash</option>
    <option value="upi">UPI</option>
    <option value="net">Net Banking</option>
    <option value="debit">Debit</option>
    <option value="credit">Credit</option>
  </select>

  <label id="toLabel" style="display:none;">To Account</label>
  <select id="to_account" style="display:none;"></select>

  <hr>

  <div id="denominationsBox" style="display:none;">
    <h3>Cash Denominations</h3>
    <div id="denominations"></div>
    <small>Negative values reduce cash</small>
    <hr>
  </div>

  <label>Amount</label>
  <input type="number" id="amount" readonly required>

  <button type="submit">Transfer</button>
</form>

<script>
  const bankAccounts = [
    "Axis", "HDFC Old", "HDFC New", "ICICI",
    "IndusInd", "Kotak", "RBL", "SBI"
  ];

  const creditCards = [
    "Axis Flipkart", "Axis MyZone", "Axis Neo",
    "HDFC PhonePe", "HDFC Tata Neu", "HDFC Millennia",
    "HSBC", "IDFC First Millenia",
    "ICICI Amazon", "ICICI Coral", "ICICI Expressions",
    "Indusind Plat Aura EDGE", "Indusind Legend",
    "Yes Finbooster", "Kotak League", "Kotak Image",
    "SBI BPCL", "Standard Chartered"
  ];

  const denominations = [500,200,100,50,20,10,5,2,1];

  function setupDropdown(trTypeId, accountId, labelId) {
    const trType = document.getElementById(trTypeId);
    const account = document.getElementById(accountId);
    const label = document.getElementById(labelId);

    trType.addEventListener("change", () => {
      account.innerHTML = "";

      if (trType.value === "cash") {
        account.style.display = "none";
        label.style.display = "none";
        toggleDenominations();
        return;
      }

      account.style.display = "block";
      label.style.display = "block";

      let options = [];
      if (["upi","net","debit"].includes(trType.value)) options = bankAccounts;
      if (trType.value === "credit") options = creditCards;

      account.innerHTML = `<option value="">Select</option>`;
      options.forEach(v => {
        account.innerHTML += `<option value="${v}">${v}</option>`;
      });

      toggleDenominations();
    });
  }

  function toggleDenominations() {
    const fromType = document.getElementById("from_trtype").value;
    const toType = document.getElementById("to_trtype").value;
    const box = document.getElementById("denominationsBox");

    if (fromType === "cash" || toType === "cash") {
      box.style.display = "block";
      createDenominations();
    } else {
      box.style.display = "none";
      document.getElementById("denominations").innerHTML = "";
      document.getElementById("amount").value = "";
    }
  }

  function createDenominations() {
    const container = document.getElementById("denominations");
    container.innerHTML = "";
    denominations.forEach(d => {
      container.innerHTML += `
        <div class="denom-row">
          <label>${d}</label>
          <input type="number" value="0" data-denom="${d}">
        </div>
      `;
    });
  }

  function calculateCashTotal() {
    let total = 0;
    document.querySelectorAll("#denominations input").forEach(i => {
      total += (Number(i.dataset.denom) * (Number(i.value) || 0));
    });
    document.getElementById("amount").value = total;
  }

  document.addEventListener("input", e => {
    if (e.target.closest("#denominations")) calculateCashTotal();
  });

  setupDropdown("from_trtype", "from_account", "fromLabel");
  setupDropdown("to_trtype", "to_account", "toLabel");

  document.getElementById("transferForm").addEventListener("submit", async e => {
    e.preventDefault();

    /* ðŸ”¥ CAPTURE DENOMINATION COUNTS */
    const cashDenoms = {};
    document.querySelectorAll("#denominations input").forEach(i => {
      cashDenoms[i.dataset.denom] = Number(i.value) || 0;
    });

    const data = {
      category: "self_transfer",
      date: date.value,
      narration: narration.value,
      from: {
        trtype: from_trtype.value,
        account: from_trtype.value === "cash" ? "Cash" : from_account.value
      },
      to: {
        trtype: to_trtype.value,
        account: to_trtype.value === "cash" ? "Cash" : to_account.value
      },
      amount: amount.value,
      cash_denominations: cashDenoms   // âœ… NEW
    };

    await fetch("https://hook.eu1.make.com/3pqalalbd6c1f1hf1guweokfv8eotdgw", {
      method: "POST",
      headers: { "Content-Type": "application/json" },
      body: JSON.stringify(data)
    });

    alert("âœ… Transfer recorded");
    transferForm.reset();
    denominationsBox.style.display = "none";
    denominations.innerHTML = "";
  });
</script>

</body>
</html>

