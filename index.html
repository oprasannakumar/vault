<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Self Transfer</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">

  <style>
    body {
      font-family: Arial, sans-serif;
      background: #f5f5f5;
      padding: 20px;
    }
    form {
      background: #ffffff;
      padding: 20px;
      border-radius: 8px;
      max-width: 430px;
      margin: auto;
      box-shadow: 0 0 10px rgba(0,0,0,0.1);
    }
    label {
      font-weight: bold;
      margin-top: 10px;
      display: block;
    }
    input, select, textarea, button {
      width: 100%;
      padding: 8px;
      margin-top: 5px;
    }
    textarea {
      resize: vertical;
    }
    hr {
      margin: 15px 0;
    }
    button {
      margin-top: 15px;
      background: #007bff;
      color: white;
      border: none;
      font-size: 16px;
      cursor: pointer;
    }
    button:hover {
      background: #0056b3;
    }

    /* Denominations grid */
    #denominations {
      display: grid;
      grid-template-columns: repeat(3, 1fr);
      gap: 8px 12px;
    }
    .denom-row {
      display: flex;
      align-items: center;
      gap: 6px;
    }
    .denom-row label {
      width: 45px;
      margin: 0;
      font-weight: bold;
    }
  </style>
</head>

<body>

<form id="transferForm">
  <h2>Self Transfer</h2>

  <label>Date</label>
  <input type="date" id="date" required>

  <label>Narration</label>
  <textarea id="narration" rows="2" required></textarea>

  <hr>

  <h3>From</h3>
  <label>Transaction Type</label>
  <select id="from_trtype" required>
    <option value="">Select</option>
    <option value="cash">Cash</option>
    <option value="upi">UPI</option>
    <option value="net">Net Banking</option>
    <option value="debit">Debit</option>
    <option value="credit">Credit</option>
  </select>

  <label id="fromLabel" style="display:none;">From Account</label>
  <select id="from_account" style="display:none;"></select>

  <hr>

  <h3>To</h3>
  <label>Transaction Type</label>
  <select id="to_trtype" required>
    <option value="">Select</option>
    <option value="cash">Cash</option>
    <option value="upi">UPI</option>
    <option value="net">Net Banking</option>
    <option value="debit">Debit</option>
    <option value="credit">Credit</option>
  </select>

  <label id="toLabel" style="display:none;">To Account</label>
  <select id="to_account" style="display:none;"></select>

  <hr>

  <!-- Cash Denominations -->
  <div id="denominationsBox" style="display:none;">
    <h3>Cash Denominations</h3>
    <div id="denominations"></div>
    <small id="cashHint"></small>
    <hr>
  </div>

  <label>Amount</label>
  <input type="number" id="amount" required>

  <button type="submit">Transfer</button>
</form>

<script>
/* ================= DATA ================= */

const bankAccounts = [
  "Axis", "HDFC Old", "HDFC New", "ICICI",
  "IndusInd", "Kotak", "RBL", "SBI"
];

const creditCards = [
  "Axis Flipkart", "Axis MyZone", "Axis Neo",
  "HDFC PhonePe", "HDFC Tata Neu", "HDFC Millennia",
  "HSBC", "IDFC First Millenia",
  "ICICI Amazon", "ICICI Coral", "ICICI Expressions",
  "Indusind Plat Aura EDGE", "Indusind Legend",
  "Yes Finbooster", "Kotak League", "Kotak Image",
  "SBI BPCL", "Standard Chartered"
];

const denominations = [500, 200, 100, 50, 20, 10, 5, 2, 1];

/* ================= DROPDOWNS ================= */

function setupDropdown(trTypeId, accountId, labelId) {
  const trType = document.getElementById(trTypeId);
  const account = document.getElementById(accountId);
  const label = document.getElementById(labelId);

  trType.addEventListener("change", () => {
    account.innerHTML = "";

    if (trType.value === "cash") {
      account.style.display = "none";
      label.style.display = "none";
      toggleCashUI();
      return;
    }

    account.style.display = "block";
    label.style.display = "block";

    let options = [];
    if (["upi","net","debit"].includes(trType.value)) options = bankAccounts;
    if (trType.value === "credit") options = creditCards;

    account.innerHTML = `<option value="">Select</option>`;
    options.forEach(v => {
      account.innerHTML += `<option value="${v}">${v}</option>`;
    });

    toggleCashUI();
  });
}

setupDropdown("from_trtype", "from_account", "fromLabel");
setupDropdown("to_trtype", "to_account", "toLabel");

/* ================= CASH LOGIC ================= */

function toggleCashUI() {
  const fromCash = document.getElementById("from_trtype").value === "cash";
  const toCash = document.getElementById("to_trtype").value === "cash";
  const box = document.getElementById("denominationsBox");
  const amount = document.getElementById("amount");
  const hint = document.getElementById("cashHint");

  if (fromCash || toCash) {
    box.style.display = "block";
    createDenominations();
    amount.readOnly = true;

    hint.textContent = fromCash
      ? "FROM Cash â†’ amount will be NEGATIVE (cash out)"
      : "TO Cash â†’ amount will be POSITIVE (cash in)";
  } else {
    box.style.display = "none";
    document.getElementById("denominations").innerHTML = "";
    amount.readOnly = false;
  }
}

function createDenominations() {
  const container = document.getElementById("denominations");
  container.innerHTML = "";

  denominations.forEach(d => {
    container.innerHTML += `
      <div class="denom-row">
        <label>${d}</label>
        <input type="number" value="0" data-denom="${d}">
      </div>
    `;
  });
}

function calculateCashAmount() {
  const fromCash = document.getElementById("from_trtype").value === "cash";
  const sign = fromCash ? -1 : 1;

  let total = 0;
  document.querySelectorAll("#denominations input").forEach(i => {
    const count = Math.abs(Number(i.value) || 0); // ðŸ”¥ normalize sign
    total += Number(i.dataset.denom) * count;
  });

  document.getElementById("amount").value = total * sign;
}

document.addEventListener("input", e => {
  if (e.target.closest("#denominations")) {
    calculateCashAmount();
  }
});

/* ================= SUBMIT ================= */

document.getElementById("transferForm").addEventListener("submit", async e => {
  e.preventDefault();

  const fromCash = document.getElementById("from_trtype").value === "cash";

  const cashDenoms = {};
  document.querySelectorAll("#denominations input").forEach(i => {
    const cleanCount = Math.abs(Number(i.value) || 0);
    cashDenoms[i.dataset.denom] = fromCash ? -cleanCount : cleanCount;
  });

  const dateValue = document.getElementById("date").value;
  const dayOnly = Number(dateValue.split("-")[2]);

  const data = {
    category: "self_transfer",
    date: dateValue,
    day: dayOnly,
    narration: document.getElementById("narration").value,
    from: {
      trtype: document.getElementById("from_trtype").value,
      account:
        document.getElementById("from_trtype").value === "cash"
          ? "Cash"
          : document.getElementById("from_account").value
    },
    to: {
      trtype: document.getElementById("to_trtype").value,
      account:
        document.getElementById("to_trtype").value === "cash"
          ? "Cash"
          : document.getElementById("to_account").value
    },
    amount: document.getElementById("amount").value,
    cash_denominations: cashDenoms
  };

  console.log("Webhook Payload:", data);

  await fetch("https://hook.eu1.make.com/uayw6m2h1u56gz1fuhnyewvh860q8tjy", {
    method: "POST",
    headers: { "Content-Type": "application/json" },
    body: JSON.stringify(data)
  });

  alert("âœ… Transfer recorded");
  document.getElementById("transferForm").reset();
  document.getElementById("denominationsBox").style.display = "none";
  document.getElementById("amount").readOnly = false;
});
</script>

</body>
</html>
