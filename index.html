<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Self Transfer</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">

  <style>
    body {
      font-family: Arial, sans-serif;
      background: #f5f5f5;
      padding: 20px;
    }
    form {
      background: #ffffff;
      padding: 20px;
      border-radius: 8px;
      max-width: 430px;
      margin: auto;
      box-shadow: 0 0 10px rgba(0,0,0,0.1);
    }
    label {
      font-weight: bold;
      margin-top: 10px;
      display: block;
    }
    input, select, textarea, button {
      width: 100%;
      padding: 8px;
      margin-top: 5px;
    }
    textarea {
      resize: vertical;
    }
    hr {
      margin: 15px 0;
    }
    button {
      margin-top: 15px;
      background: #007bff;
      color: white;
      border: none;
      font-size: 16px;
      cursor: pointer;
    }
    button:hover {
      background: #0056b3;
    }

    /* ---------- Denominations Grid ---------- */
    #denominations {
      display: grid;
      grid-template-columns: repeat(3, 1fr);
      gap: 8px 12px;
    }
    .denom-row {
      display: flex;
      align-items: center;
      gap: 6px;
    }
    .denom-row label {
      width: 45px;
      margin: 0;
      font-weight: bold;
    }
    .denom-row input {
      width: 100%;
    }
  </style>
</head>

<body>

<form id="transferForm">
  <h2>Self Transfer</h2>

  <label>Date</label>
  <input type="date" id="date" required>

  <label>Narration</label>
  <textarea
    id="narration"
    rows="2"
    placeholder="Eg: Transfer from Axis to Cash"
    required
  ></textarea>

  <hr>

  <h3>From</h3>
  <label>Transaction Type</label>
  <select id="from_trtype" required>
    <option value="">Select</option>
    <option value="cash">Cash</option>
    <option value="upi">UPI</option>
    <option value="net">Net Banking</option>
    <option value="debit">Debit</option>
    <option value="credit">Credit</option>
  </select>

  <label id="fromLabel" style="display:none;">From Account</label>
  <select id="from_account" style="display:none;"></select>

  <hr>

  <h3>To</h3>
  <label>Transaction Type</label>
  <select id="to_trtype" required>
    <option value="">Select</option>
    <option value="cash">Cash</option>
    <option value="upi">UPI</option>
    <option value="net">Net Banking</option>
    <option value="debit">Debit</option>
    <option value="credit">Credit</option>
  </select>

  <label id="toLabel" style="display:none;">To Account</label>
  <select id="to_account" style="display:none;"></select>

  <hr>

  <!-- Cash Denominations -->
  <div id="denominationsBox" style="display:none;">
    <h3>Cash Denominations</h3>
    <div id="denominations"></div>
    <small>Use negative numbers to reduce cash</small>
    <hr>
  </div>

  <label>Amount</label>
  <input type="number" id="amount" required readonly>

  <button type="submit">Transfer</button>
</form>

<script>
  const bankAccounts = [
    "Axis", "HDFC Old", "HDFC New", "ICICI",
    "IndusInd", "Kotak", "RBL", "SBI"
  ];

  const creditCards = [
    "Axis Flipkart", "Axis MyZone", "Axis Neo",
    "HDFC PhonePe", "HDFC Tata Neu", "HDFC Millennia",
    "HSBC", "IDFC First Millenia",
    "ICICI Amazon", "ICICI Coral", "ICICI Expressions",
    "Indusind Plat Aura EDGE", "Indusind Legend",
    "Yes Finbooster", "Kotak League", "Kotak Image",
    "SBI BPCL", "Standard Chartered"
  ];

  const denominations = [500, 200, 100, 50, 20, 10, 5, 2, 1];

  function setupDropdown(trTypeId, accountId, labelId) {
    const trType = document.getElementById(trTypeId);
    const account = document.getElementById(accountId);
    const label = document.getElementById(labelId);

    trType.addEventListener("change", () => {
      account.innerHTML = "";

      if (trType.value === "cash") {
        account.style.display = "none";
        label.style.display = "none";
        account.required = false;
        toggleDenominations();
        return;
      }

      account.style.display = "block";
      label.style.display = "block";
      account.required = true;

      let options = [];
      if (["upi", "net", "debit"].includes(trType.value)) options = bankAccounts;
      if (trType.value === "credit") options = creditCards;

      const def = document.createElement("option");
      def.value = "";
      def.text = "Select";
      account.appendChild(def);

      options.forEach(v => {
        const opt = document.createElement("option");
        opt.value = v;
        opt.text = v;
        account.appendChild(opt);
      });

      toggleDenominations();
    });
  }

  function toggleDenominations() {
    const fromType = document.getElementById("from_trtype").value;
    const toType = document.getElementById("to_trtype").value;
    const box = document.getElementById("denominationsBox");

    if (fromType === "cash" || toType === "cash") {
      box.style.display = "block";
      createDenominations();
    } else {
      box.style.display = "none";
      document.getElementById("denominations").innerHTML = "";
      document.getElementById("amount").value = "";
    }
  }

  function createDenominations() {
    const container = document.getElementById("denominations");
    container.innerHTML = "";

    denominations.forEach(d => {
      const row = document.createElement("div");
      row.className = "denom-row";
      row.innerHTML = `
        <label>${d}</label>
        <input type="number" value="0" data-denom="${d}">
      `;
      container.appendChild(row);
    });
  }

  function calculateCashTotal() {
    let total = 0;
    document.querySelectorAll("#denominations input").forEach(input => {
      const denom = Number(input.dataset.denom);
      const count = Number(input.value) || 0;
      total += denom * count;
    });
    document.getElementById("amount").value = total;
  }

  document.addEventListener("input", e => {
    if (e.target.closest("#denominations")) {
      calculateCashTotal();
    }
  });

  setupDropdown("from_trtype", "from_account", "fromLabel");
  setupDropdown("to_trtype", "to_account", "toLabel");

  document.getElementById("transferForm").addEventListener("submit", async e => {
    e.preventDefault();

    const data = {
      category: "self_transfer",
      date: document.getElementById("date").value,
      narration: document.getElementById("narration").value,
      from: {
        trtype: document.getElementById("from_trtype").value,
        account:
          document.getElementById("from_trtype").value === "cash"
            ? "Cash"
            : document.getElementById("from_account").value
      },
      to: {
        trtype: document.getElementById("to_trtype").value,
        account:
          document.getElementById("to_trtype").value === "cash"
            ? "Cash"
            : document.getElementById("to_account").value
      },
      amount: document.getElementById("amount").value
    };

    try {
      await fetch("https://hook.eu1.make.com/3pqalalbd6c1f1hf1guweokfv8eotdgw", {
        method: "POST",
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify(data)
      });

      alert("✅ Transfer recorded");
      document.getElementById("transferForm").reset();
      document.getElementById("denominationsBox").style.display = "none";
      document.getElementById("denominations").innerHTML = "";

    } catch (err) {
      alert("❌ Error submitting transfer");
      console.error(err);
    }
  });
</script>

</body>
</html>
